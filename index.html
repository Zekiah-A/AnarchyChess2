<!DOCTYPE html>
<html>
<head>
    <title>Riot Chess</title>
    <meta name="description" content="A massive multiplayer chess game with slightly bent rules. Here be anarchy.">
    <meta name="keywords" content="chess anarchy game multiplayer online">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <p class="copyright-notice">
        If you're seeing this, you probably moved the board offscreen. ChessGaem, ¬©Zekiah-A
    </p>
    <div id="gamemodeTitle" class="hud" onclick="gamemodesPanel.toggleAttribute('closed');">
        <p>ChessGaem</p>
    </div>

    <div id="gamemodesPanel" class="info-panel" closed="">
        <h4 style="margin: 0px;">Match options:</h4>
        <input type="button" value="Request replay">
        <input type="button" value="Exit match">
    </div>

    <div class="hud game-actions">
        <p onclick="chatPanel.toggleAttribute('closed'); settingsPanel.setAttribute('closed', 'true')">Chat</p>
        <p onclick="settingsPanel.toggleAttribute('closed'); chatPanel.setAttribute('closed', 'true')">Settings</p>
        <p>Help</p>
    </div>

    <div id="chatPanel" closed="true" class="info-panel">
        <div id="chatMessages">
            <p>ü¢Ç Chat messages will appear here</p>
        </div>
        <input type="text" maxlength="250" onkeydown="
            if (event.key == 'Enter') {
                let input = this;
                //sendChatMessage(input.value);
                input.value = '';
            }
        ">
    </div>

    <div id="settingsPanel" closed="true" class="info-panel">
        <h4 style="margin: 0px;">Graphics options:</h4>
        <div style="display: flex;flex-direction: column;row-gap: 3px;" onclick="">
            <input type="button" value="Low graphics">
            <input type="button" value="Medium graphics">
            <input type="button" value="High graphics">
        </div>
    </div>

    <div id="turnPanel" class="info-panel">
        <div id="turnProgress"></div>
        <div id="turnLabel" style="white-space: pre;">Current turn: 1             (5s)</div>
    </div>
    
    <div id="infoPanel" class="info-panel">
        <p>Zoom: <span id="zoomIndicator">0.4</span>x</p>
        <p>Board: <span id="boardIndicator">0, 0</span></p>
        <p>Position: <span id="tileIndicator">A1</span></p>
    </div>

    <div id="deathMenu" closed="true" class="menu">
        <h1 style="margin-bottom: 8px;">‚ôüÔ∏è BLUNDER</h1>
        <p>You were killed by another piece.</p>
        <div class="dual-options">
            <input value="Respawn on map" type="button">
            <input value="Main menu" type="button">
        </div>
    </div>
    
    <div id="mainMenu" class="main-menu">
        <canvas id="canvas" style="z-index: -1;width: 100%;height: 100%;top: 0px; left: 0px;position: absolute;background: #c7c7c7;"></canvas>
        <div style="display: flex; flex-direction: column; column-gap: 8px;">
            <h1>ChessGaem</h1>
            <p>A multiplayer chess board, with infinite variations slightly bent rules. Here be anarchy.</p>
            <div id="configurePanel" class="modal" closed>
                <ul class="modal-title">
                    <li selected>
                        Starting piece arrangement
                    </li>
                    <li>
                        As
                    </li>    
                </ul>
                <div class="modal-content">
                    <div class="arrangement-content">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox=".95 .45 8.1 8.1">
                            <circle r="99"></circle><path d="M1,1h7M2,2h7M1,3h7M2,4h7M1,5h7M2,6h7M1,7h7M2,8h7" stroke="#fff" stroke-dasharray="1"></path>
                        </svg>
                        <div class="arangement-side">
                            <div class="arrangement-section">Black</div>
                            <div class="arrangement-section">White</div>
                            <div style="flex-grow: 1;"></div>
                            <div class="arrangement-button" tabindex="1">Delete piece üóëÔ∏è</div>
                        </div>
                    </div>
                    <span id="arrangementStats">Black pieces: 2, White pieces: 3, White king present: ‚úÖ, Black king present: ‚úÖ</span>
                </div>
            </div>
            <input style="aspect-ratio: 1/1;" value="Create new ruleset" type="button" onclick="configurePanel.removeAttribute('closed')">
            <input style="width: 40%;" value="Play" type="button" onclick="mainMenu.style.display = 'none';">
        </div>
    </div>

    <div id="spawnMenu" style="display: none;" class="menu spawn-menu">
        <h2>Choose your spawn location</h2>
        <div class="dual-options">
            <input id="tokenSpawnButton" value="Continue from last location" type="button" onclick="">
            <input value="Random location" type="button" onclick="">
        </div>
    </div>
    <div id="meTurnPopup">It is now your turn!</div>
    <div style="
        position: absolute;
        left: 0px;
        height: 100%;
        width: min(360px, 100%);
        background: var(--ui-background);
        z-index: 2;
        padding: 16px;
        box-sizing: border-box;
        box-shadow: 0px 0px 12px black;
        display: none;
    ">
        <h4>Game rules:</h4>
        <div class="match-rules">
            <h5 style="margin-bottom: 0px;">Game events:</h5>
            <div>
                <span kind="keyword">WHEN</span> <span layer="0">the game starts</span> <span layer="0">it is black's move</span><span>.</span>
            </div>
            <div>
                <span kind="keyword">WHEN</span> <span layer="0">black's queen is taken</span> <span layer="0">white must forfeit<span layer="1">a pawn</span></span><span>.</span>
            </div>
            <h5 style="margin-bottom: 0px;">Per move ruleset:</h5>
        </div>
    </div>
</body>
<script>
    // GLSL background effect
	function loadShader(gl, type, source) {
		const shader = gl.createShader(type)
		gl.shaderSource(shader, source)
		gl.compileShader(shader)
		if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
			console.error(`Failed to compile shader: ${gl.getShaderInfoLog(shader)}`)
			gl.deleteShader(shader)
			return null
		}

		return shader
	}

	function compileShaderProgram(gl, vertexSource, fragmentSource) {
		const vertexShader = loadShader(gl, gl.VERTEX_SHADER, vertexSource)
		const fragmentShader = loadShader(gl, gl.FRAGMENT_SHADER, fragmentSource)

		const program = gl.createProgram()
		gl.attachShader(program, vertexShader)
		gl.attachShader(program, fragmentShader)
		gl.linkProgram(program)

		if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
			console.error(`Failed to init shader: ${gl.getProgramInfoLog(program,)}`)
			return null
		}
		
		return program
	}

	const vertex = `
		attribute vec4 aVertexPosition;
		
		void main()
		{
			gl_Position = aVertexPosition;
		}
	`
	const fragment = `
		#ifdef GL_ES
			precision mediump float;
		#endif
		uniform float time;
		uniform vec2 viewportSize;
        const float checkerSize = 120.0;

		void main()
		{
            vec2 position = floor(gl_FragCoord.xy / checkerSize);
            float patternMask =  mod(position.x + mod(position.y, 2.0), 2.0);
            gl_FragColor = vec4(
                patternMask * (sin(time / 100.0) + 1.0),
                patternMask * (sin(time / 100.0 + 3.9) + 1.0),
                patternMask * (sin(time / 100.0 + 1.7) + 1.0),
                0.2);
        }
	`

	const gl = canvas.getContext("webgl")
    gl.clear(gl.COLOR_BUFFER_BIT)
	
	function bindBufferPositionAttrib(gl, buffer, vertexPositionAttrib) {
		const components = 2
		const type = gl.FLOAT
		const normalize = false
		const stride = 0 // Ignore, use components & type to determine byte stride
		const offset = 0 // Start from buffer start

		gl.bindBuffer(gl.ARRAY_BUFFER, buffer)
		gl.vertexAttribPointer(vertexPositionAttrib, components, type, normalize, stride, offset)
		gl.enableVertexAttribArray(vertexPositionAttrib)
	}

	function createPositionBuffer(positionsArr) {
		const buffer = gl.createBuffer()
		gl.bindBuffer(gl.ARRAY_BUFFER, buffer)
		gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positionsArr), gl.STATIC_DRAW)

		return buffer
	}

	const program = compileShaderProgram(gl, vertex, fragment)
	const vertexPosAttrib = gl.getAttribLocation(program, "aVertexPosition")
	const vertexPosBuffer = createPositionBuffer([1.0, 1.0, -1.0, 1.0, 1.0, -1.0, -1.0, -1.0])
	bindBufferPositionAttrib(gl, vertexPosBuffer, vertexPosAttrib)

	gl.useProgram(program)

	const uniformVpSize = gl.getUniformLocation(program, "viewportSize")
	const uniformTime = gl.getUniformLocation(program, "time")

	function updateViewportSize() {
		canvas.width = canvas.offsetWidth
		canvas.height = canvas.offsetHeight
		gl.viewport(0, 0, canvas.width, canvas.height)
		gl.uniform2f(uniformVpSize, canvas.width, canvas.height)
	}
	
	updateViewportSize()
	addEventListener("resize", updateViewportSize)
	let i = 0
	setInterval(() => {
		gl.clear(gl.COLOR_BUFFER_BIT)

		gl.uniform1f(uniformTime, i++)
		gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4) // offset, vertex count
	}, 16)
</script>
</html>