<!DOCTYPE html>
<html>
<head>
    <title>Anarchy chess</title>
    <meta name="description" content="A massive multiplayer chess game with slightly bent rules. Here be anarchy.">
    <meta name="keywords" content="chess anarchy game multiplayer online">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/x-icon" href="resources/logo.ico">
    <meta charset="UTF-8">
</head>
<body>
    <p class="copyright-notice">
        If you're seeing this, you probably moved the board offscreen. AnarchyChess, ¬©Zekiah-A
    </p>
    <div id="gamemodeTitle" class="hud" onclick="gamemodesPanel.toggleAttribute('closed');">
        <p>AnarchyChess</p>
    </div>
    <div id="gamemodesPanel" class="info-panel" closed="">
        <h4 style="margin: 0px;">Match options:</h4>
        <input type="button" value="Request replay">
        <input type="button" value="Exit match">
    </div>
    <div class="hud game-actions">
        <p onclick="chatPanel.toggleAttribute('closed'); settingsPanel.setAttribute('closed', true);">Chat</p>
        <p onclick="settingsPanel.toggleAttribute('closed'); chatPanel.setAttribute('closed', true);">Settings</p>
        <p>Help</p>
    </div>
    <div id="chatPanel" closed="true" class="info-panel">
        <div id="chatMessages">
            <p>ü¢Ç Chat messages will appear here</p>
        </div>
        <input type="text" maxlength="250" onkeydown="
            if (event.key == 'Enter') {
                let input = this;
                //sendChatMessage(input.value);
                input.value = '';
            }
        ">
    </div>
    <div id="settingsPanel" closed="true" class="info-panel">
        <h4 style="margin: 0px;">Graphics options:</h4>
        <div style="display: flex;flex-direction: column;row-gap: 3px;" onclick="">
            <input type="button" value="Low graphics">
            <input type="button" value="Medium graphics">
            <input type="button" value="High graphics">
        </div>
    </div>
    <div id="turnPanel" class="info-panel">
        <div id="turnProgress"></div>
        <div id="turnLabel" style="white-space: pre;">Current turn: 1            (5s)</div>
    </div>
    <div id="infoPanel" class="info-panel">
        <p>Zoom: <span id="zoomIndicator">0.4</span>x</p>
        <p>Board: <span id="boardIndicator">0, 0</span></p>
        <p>Position: <span id="tileIndicator">A1</span></p>
    </div>
    <div id="deathMenu" closed="true" class="menu">
        <h1 style="margin-bottom: 8px;">‚ôüÔ∏è BLUNDER</h1>
        <p>You were killed by another piece.</p>
        <div class="dual-options">
            <input value="Respawn on map" type="button">
            <input value="Main menu" type="button">
        </div>
    </div>
    <div id="mainMenu" class="main-menu">
        <header id="header">
            <div id="headerBranding" class="branding">
                <img src="resources/logo.png" height="64" alt="logo">
                <h1>AnarchyChess</h1>
            </div>
            <nav id="headerNav">
                <a class="novisit" href="#login">Login</a> |
                <a class="novisit" href="#signup">Sign up</a> |
                <a class="novisit" href="#profile">My profile</a> |
                <a class="novisit" href="#settings">Settings</a>
            </nav>
        </header>
        <div style="display: flex; flex-direction: column; row-gap: 8px;">
            <div style="height: 200px;"><!--spacer--></div>
            <p style="text-align: center;">A multiplayer chess board, with infinite variations slightly bent rules. Here be anarchy.</p>
            <div id="configurePanel" class="modal" closed>
                <ul class="modal-title" onclick="if (event.target.nodeName == 'LI') {
                    this.querySelectorAll('li').forEach(element => {
                        element.removeAttribute('selected')
                    })
                    event.target.setAttribute('selected', true)
                    configurePanel.querySelectorAll('.modal-content').forEach(element => element.style.display = 'none')
                    configurePanel.querySelector(`.modal-content[page=\x22${event.target.dataset.page}\x22]`).style.display = 'flex'
                }">
                    <li selected data-page="arrangement">Starting piece arrangement</li>
                    <li data-page="ruleset">Ruleset</li>
                </ul>
                <div class="modal-content" page="arrangement">
                    <div class="arrangement-content">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox=".95 .45 8.1 8.1">
                            <circle r="99"></circle><path d="M1,1h7M2,2h7M1,3h7M2,4h7M1,5h7M2,6h7M1,7h7M2,8h7" stroke="#fff" stroke-dasharray="1"></path>
                        </svg>
                        <div class="arangement-side">
                            <div class="arrangement-section">Black</div>
                            <div class="arrangement-section">White</div>
                            <div style="flex-grow: 1;"></div>
                            <div class="arrangement-button" tabindex="1">Delete piece üóëÔ∏è</div>
                        </div>
                    </div>
                    <span id="arrangementStats">Black pieces: 2, White pieces: 3, White king present: ‚úÖ, Black king present: ‚úÖ</span>
                </div>
                <div class="modal-content" page="ruleset" style="display: none;">
                    Ruleset options
                </div>
            </div>
            <div style="height: 2000px;"></div>
            <input style="aspect-ratio: 1/1;" value="Create new ruleset" type="button" onclick="configurePanel.removeAttribute('closed')">
            <input style="width: 40%;" value="Play" type="button" onclick="mainMenu.style.display = 'none';">
        </div>
    </div>
    <div id="spawnMenu" style="display: none;" class="menu spawn-menu">
        <h2>Choose your spawn location</h2>
        <div class="dual-options">
            <input id="tokenSpawnButton" value="Continue from last location" type="button" onclick="">
            <input value="Random location" type="button" onclick="">
        </div>
    </div>
    <div id="meTurnPopup">It is now your turn!</div>
    <div style="
        position: absolute;
        left: 0px;
        height: 100%;
        width: min(360px, 100%);
        background: var(--ui-background);
        z-index: 2;
        padding: 16px;
        box-sizing: border-box;
        box-shadow: 0px 0px 12px black;
        display: none;
    ">
        <h4>Game rules:</h4>
        <div class="match-rules">
            <h5 style="margin-bottom: 0px;">Game events:</h5>
            <div>
                <span kind="keyword">WHEN</span> <span layer="0">the game starts</span> <span layer="0">it is black's move</span><span>.</span>
            </div>
            <div>
                <span kind="keyword">WHEN</span> <span layer="0">black's queen is taken</span> <span layer="0">white must forfeit<span layer="1">a pawn</span></span><span>.</span>
            </div>
            <h5 style="margin-bottom: 0px;">Per move ruleset:</h5>
        </div>
    </div>
</body>
<script>
    function lerp(from, to, weight){
        return (1 - weight) * from + weight *to
    }
    let scrollAnim = null
    function calcHeaderPositioning() {        
        const toCollapsed = Math.min(1, mainMenu.scrollTop / 200)
        const headerCentreX = header.offsetWidth / 2
        header.style.boxShadow = `0px 0px ${Math.min(8, mainMenu.scrollTop)}px gray`
        header.style.height = `${Math.max(100, 200 - mainMenu.scrollTop)}px`
        headerBranding.style.left = `${lerp(headerCentreX - headerBranding.offsetWidth / 2, 16, toCollapsed)}px`
        headerBranding.style.scale = lerp(1.2, 0.8, toCollapsed)

        headerNav.style.left = `${lerp(headerCentreX - headerNav.offsetWidth / 2, header.offsetWidth - headerNav.offsetWidth - 16, toCollapsed)}px`
        headerNav.style.top = `${lerp(120, 50 - headerNav.offsetHeight / 2, toCollapsed)}px`

        if (scrollAnim) {
            clearTimeout(scrollAnim)
            scrollAnim = null
        }
        if (mainMenu.scrollTop < 200) {
            let scrollTarget = toCollapsed < 0.5 ? 0 : 200
            scrollAnim = setTimeout(() => {
                mainMenu.scrollTo({
                    top: scrollTarget,
                    left: 0,
                    behavior: "smooth",
                })
            }, 200)
        }
    }
    mainMenu.addEventListener("scroll", calcHeaderPositioning)
    window.addEventListener("resize", calcHeaderPositioning)
    calcHeaderPositioning()
</script>
</html>
